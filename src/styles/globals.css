@tailwind base;
@tailwind components;
@tailwind utilities;

@layer base {
  :root {
    --font-serif: "Playfair Display", "Merriweather", "GenRyuMin JP Auto", "GenRyuMin TW Auto", var(--font-genryumin), serif;
    --font-sans: "Inter", "Roboto", sans-serif;
    --font-mono: "JetBrains Mono", monospace;
    --color-ink: #1a1a1a;
    --color-paper: #fafafa;
    --color-accent: #dc2626;
    --color-gray: #6b7280;
  }

  /* View Transitions API for smooth theme switching */
  ::view-transition-old(root),
  ::view-transition-new(root) {
    animation-duration: 0.5s;
  }

  html {
    font-size: 16px;
    scroll-behavior: smooth;
  }

  body {
    @apply bg-newspaper-paper text-newspaper-ink font-sans antialiased;
    min-height: -webkit-fill-available;
    overflow-x: hidden;
    word-wrap: break-word;
    overflow-wrap: break-word;
  }

  .dark body {
    @apply bg-zinc-900 text-zinc-100;
  }

  ::selection {
    @apply bg-newspaper-accent text-newspaper-paper;
  }

  .dark ::selection {
    @apply bg-red-400 text-zinc-900;
  }

  /* Japanese content uses Japanese font variant */
  :lang(ja) {
    font-family: var(--font-genryumin-jp), var(--font-genryumin), "Playfair Display", "Merriweather", serif;
  }

  /* Ensure CJK characters render properly */
  body {
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
    text-rendering: optimizeLegibility;
  }

  /* Custom scrollbar styles - Editorial design */
  ::-webkit-scrollbar {
    width: 20px;
    height: 20px;
  }

  ::-webkit-scrollbar-track {
    background: rgba(0, 0, 0, 0.03);
    border-left: 1px solid rgba(0, 0, 0, 0.1);
  }

  ::-webkit-scrollbar-thumb {
    background-color: var(--color-gray);
    background-image:
      repeating-linear-gradient(
        45deg,
        transparent,
        transparent 2px,
        rgba(0, 0, 0, 0.05) 2px,
        rgba(0, 0, 0, 0.05) 4px
      );
    border-radius: 0;
    transition: background-color 0.2s ease;
  }

  ::-webkit-scrollbar-thumb:hover {
    background-color: var(--color-ink);
    background-image:
      repeating-linear-gradient(
        45deg,
        transparent,
        transparent 2px,
        rgba(255, 255, 255, 0.1) 2px,
        rgba(255, 255, 255, 0.1) 4px
      );
  }

  ::-webkit-scrollbar-thumb:active {
    background-color: var(--color-accent);
    background-image:
      repeating-linear-gradient(
        45deg,
        transparent,
        transparent 2px,
        rgba(255, 255, 255, 0.15) 2px,
        rgba(255, 255, 255, 0.15) 4px
      );
  }

  /* Dark mode scrollbar */
  .dark ::-webkit-scrollbar-track {
    background: rgba(255, 255, 255, 0.03);
    border-left: 1px solid rgba(255, 255, 255, 0.1);
  }

  .dark ::-webkit-scrollbar-thumb {
    background-color: #52525b;
    background-image:
      repeating-linear-gradient(
        45deg,
        transparent,
        transparent 2px,
        rgba(255, 255, 255, 0.05) 2px,
        rgba(255, 255, 255, 0.05) 4px
      );
  }

  .dark ::-webkit-scrollbar-thumb:hover {
    background-color: #a1a1aa;
    background-image:
      repeating-linear-gradient(
        45deg,
        transparent,
        transparent 2px,
        rgba(255, 255, 255, 0.08) 2px,
        rgba(255, 255, 255, 0.08) 4px
      );
  }

  .dark ::-webkit-scrollbar-thumb:active {
    background-color: #ef4444;
    background-image:
      repeating-linear-gradient(
        45deg,
        transparent,
        transparent 2px,
        rgba(255, 255, 255, 0.1) 2px,
        rgba(255, 255, 255, 0.1) 4px
      );
  }
}

/* Auto-detect Japanese characters using @font-face with unicode-range */
/* Japanese Hiragana, Katakana unicode-range: U+3040-309F, U+30A0-30FF */
@font-face {
  font-family: "GenRyuMin JP Auto";
  src: url("/fonts/GenRyuMin2JP-otf/GenRyuMin2JP-L.otf") format("opentype");
  font-weight: 300;
  font-style: normal;
  font-display: swap;
  unicode-range: U+3040-309F, U+30A0-30FF;
}

@font-face {
  font-family: "GenRyuMin JP Auto";
  src: url("/fonts/GenRyuMin2JP-otf/GenRyuMin2JP-R.otf") format("opentype");
  font-weight: 400;
  font-style: normal;
  font-display: swap;
  unicode-range: U+3040-309F, U+30A0-30FF;
}

@font-face {
  font-family: "GenRyuMin JP Auto";
  src: url("/fonts/GenRyuMin2JP-otf/GenRyuMin2JP-M.otf") format("opentype");
  font-weight: 500;
  font-style: normal;
  font-display: swap;
  unicode-range: U+3040-309F, U+30A0-30FF;
}

@font-face {
  font-family: "GenRyuMin JP Auto";
  src: url("/fonts/GenRyuMin2JP-otf/GenRyuMin2JP-SB.otf") format("opentype");
  font-weight: 600;
  font-style: normal;
  font-display: swap;
  unicode-range: U+3040-309F, U+30A0-30FF;
}

@font-face {
  font-family: "GenRyuMin JP Auto";
  src: url("/fonts/GenRyuMin2JP-otf/GenRyuMin2JP-B.otf") format("opentype");
  font-weight: 700;
  font-style: normal;
  font-display: swap;
  unicode-range: U+3040-309F, U+30A0-30FF;
}

/* Traditional Chinese - will match all CJK characters not in Japanese range */
@font-face {
  font-family: "GenRyuMin TW Auto";
  src: url("/fonts/GenRyuMin2TW-otf/GenRyuMin2TW-L.otf") format("opentype");
  font-weight: 300;
  font-style: normal;
  font-display: swap;
  unicode-range: U+2E80-2EFF, U+3000-303F, U+31C0-31EF, U+3200-32FF, U+3400-4DBF, U+4E00-9FFF, U+F900-FAFF, U+FE30-FE4F, U+FF00-FFEF;
}

@font-face {
  font-family: "GenRyuMin TW Auto";
  src: url("/fonts/GenRyuMin2TW-otf/GenRyuMin2TW-R.otf") format("opentype");
  font-weight: 400;
  font-style: normal;
  font-display: swap;
  unicode-range: U+2E80-2EFF, U+3000-303F, U+31C0-31EF, U+3200-32FF, U+3400-4DBF, U+4E00-9FFF, U+F900-FAFF, U+FE30-FE4F, U+FF00-FFEF;
}

@font-face {
  font-family: "GenRyuMin TW Auto";
  src: url("/fonts/GenRyuMin2TW-otf/GenRyuMin2TW-M.otf") format("opentype");
  font-weight: 500;
  font-style: normal;
  font-display: swap;
  unicode-range: U+2E80-2EFF, U+3000-303F, U+31C0-31EF, U+3200-32FF, U+3400-4DBF, U+4E00-9FFF, U+F900-FAFF, U+FE30-FE4F, U+FF00-FFEF;
}

@font-face {
  font-family: "GenRyuMin TW Auto";
  src: url("/fonts/GenRyuMin2TW-otf/GenRyuMin2TW-SB.otf") format("opentype");
  font-weight: 600;
  font-style: normal;
  font-display: swap;
  unicode-range: U+2E80-2EFF, U+3000-303F, U+31C0-31EF, U+3200-32FF, U+3400-4DBF, U+4E00-9FFF, U+F900-FAFF, U+FE30-FE4F, U+FF00-FFEF;
}

@font-face {
  font-family: "GenRyuMin TW Auto";
  src: url("/fonts/GenRyuMin2TW-otf/GenRyuMin2TW-B.otf") format("opentype");
  font-weight: 700;
  font-style: normal;
  font-display: swap;
  unicode-range: U+2E80-2EFF, U+3000-303F, U+31C0-31EF, U+3200-32FF, U+3400-4DBF, U+4E00-9FFF, U+F900-FAFF, U+FE30-FE4F, U+FF00-FFEF;
}


@layer components {
  a {
    @apply underline-offset-4 transition-colors duration-150 ease-out;
  }

  a:hover {
    @apply text-newspaper-accent dark:text-red-400;
  }

  .dropcap:first-letter {
    @apply float-left mr-3 mt-1 text-6xl font-serif font-bold leading-none text-newspaper-accent dark:text-red-400;
  }

  .prose {
    @apply max-w-prose;
    word-wrap: break-word;
    overflow-wrap: break-word;
  }

  .prose img {
    @apply rounded-none border border-black/5 shadow-editorial dark:border-white/5;
    max-width: 100%;
    height: auto;
  }

  .prose figure {
    @apply my-8;
    max-width: 100%;
    overflow-x: auto;
  }

  .prose figcaption {
    @apply mt-3 text-sm font-serif uppercase tracking-[0.22em] text-newspaper-gray dark:text-zinc-400;
  }

  .prose pre {
    max-width: 100%;
    overflow-x: auto;
  }

  .prose code {
    word-wrap: break-word;
    overflow-wrap: break-word;
    word-break: break-all;
  }

  .prose table {
    display: block;
    max-width: 100%;
    overflow-x: auto;
  }

  .sr-only-focusable:focus {
    @apply not-sr-only absolute left-4 top-4 inline-flex items-center rounded bg-newspaper-ink px-3 py-2 text-sm font-semibold tracking-wide text-newspaper-paper shadow-lg focus:outline-none focus:ring-2 focus:ring-newspaper-accent dark:bg-zinc-100 dark:text-zinc-900 dark:focus:ring-red-400;
  }

  /* Archive loading animation */
  .archive-loader {
    width: fit-content;
    font-size: 40px;
    font-family: var(--font-serif);
    font-weight: bold;
    text-transform: uppercase;
    color: transparent;
    -webkit-text-stroke: 1px var(--color-ink);
    background: conic-gradient(var(--color-ink) 0 0) text;
    -webkit-background-clip: text;
    background-clip: text;
    animation: archive-loading 2s linear infinite;
  }

  .archive-loader::before {
    content: "Loading";
  }

  .dark .archive-loader {
    -webkit-text-stroke: 1px theme('colors.zinc.100');
    background: conic-gradient(theme('colors.zinc.100') 0 0) text;
    -webkit-background-clip: text;
    background-clip: text;
  }

  @keyframes archive-loading {

    0%,
    2%,
    8%,
    11%,
    15%,
    21%,
    30%,
    32%,
    35%,
    40%,
    46%,
    47%,
    53%,
    61%,
    70%,
    72%,
    77%,
    80%,
    86% {
      background-size: 0 0;
    }

    1%,
    9%,
    10%,
    16%,
    20%,
    31%,
    34%,
    41%,
    45%,
    48%,
    52%,
    55%,
    60%,
    73%,
    76%,
    81%,
    85%,
    96%,
    100% {
      background-size: 100% 100%;
    }
  }

  .markdown-editor {
    @apply border border-black/10 bg-white dark:border-white/10 dark:bg-zinc-900;
  }

  .markdown-editor .w-md-editor {
    @apply !bg-transparent !shadow-none !border-0 !text-newspaper-ink dark:!text-zinc-100;
    --md-editor-background-color: transparent;
    --md-editor-box-shadow-color: rgba(17, 24, 39, 0.12);
  }

  .dark .markdown-editor .w-md-editor {
    --md-editor-box-shadow-color: rgba(250, 250, 250, 0.12);
  }

  .markdown-editor .w-md-editor-toolbar {
    @apply !bg-transparent !border-b !border-black/10 !px-3 !py-2 dark:!border-white/10;
  }

  .markdown-editor .w-md-editor-toolbar ul {
    @apply flex flex-wrap gap-1;
  }

  .markdown-editor .w-md-editor-toolbar ul li button {
    @apply !h-8 !w-8 !rounded-md !border !border-transparent !bg-transparent !text-newspaper-gray hover:!border-black/10 hover:!bg-zinc-100 hover:!text-newspaper-ink dark:!text-zinc-400 dark:hover:!border-white/10 dark:hover:!bg-zinc-800 dark:hover:!text-zinc-100;
  }

  .markdown-editor .w-md-editor-toolbar-divider {
    @apply !mx-2 !border-r !border-black/10 dark:!border-white/10;
  }

  .markdown-editor .w-md-editor-content,
  .markdown-editor .w-md-editor-text,
  .markdown-editor .w-md-editor-text-pre,
  .markdown-editor .w-md-editor-text-input {
    @apply !bg-transparent !font-mono !text-sm !text-newspaper-ink dark:!text-zinc-100;
  }

  .markdown-editor .w-md-editor-text {
    @apply !px-4 !py-3;
  }

  /* Fix text wrapping in editor */
  .markdown-editor .w-md-editor-text-pre,
  .markdown-editor .w-md-editor-text-input {
    white-space: pre-wrap !important;
    word-wrap: break-word !important;
    overflow-wrap: break-word !important;
  }

  .markdown-editor .w-md-editor-text-pre>code {
    white-space: pre-wrap !important;
    word-wrap: break-word !important;
    overflow-wrap: break-word !important;
  }

  .markdown-editor .w-md-editor-preview {
    @apply !px-5 !py-4 !text-newspaper-ink !bg-newspaper-paper dark:!text-zinc-100 dark:!bg-zinc-900;
  }

  .markdown-editor .wmde-markdown {
    @apply prose prose-sm max-w-none text-newspaper-ink dark:text-zinc-100;
    background-color: transparent !important;
  }

  .markdown-editor .wmde-markdown-color {
    @apply !bg-transparent;
  }

  .markdown-editor .w-md-editor-preview>.wmde-markdown,
  .markdown-editor .w-md-editor-preview>div {
    background-color: transparent !important;
  }

  .markdown-editor .wmde-markdown hr {
    @apply border-black/10 dark:border-white/10;
  }

  .markdown-editor .wmde-markdown table {
    @apply w-full border-collapse border border-black/10 dark:border-white/10;
  }

  .markdown-editor .wmde-markdown th,
  .markdown-editor .wmde-markdown td {
    @apply border border-black/10 px-3 py-2 text-left dark:border-white/10;
  }

  .markdown-editor .w-md-editor-bar {
    @apply !bg-transparent;
  }

  .markdown-editor .w-md-editor-content {
    @apply !border-0;
  }

  .markdown-editor .w-md-editor-input {
    @apply !border-r !border-black/10 dark:!border-white/10;
  }

  .markdown-editor .w-md-editor-preview {
    @apply !border-l !border-black/10 !bg-newspaper-paper dark:!border-white/10 dark:!bg-zinc-900;
    box-shadow: none !important;
  }

  /* Additional fixes for markdown editor preview background */
  .markdown-editor .w-md-editor-preview *,
  .markdown-editor .wmde-markdown *,
  .markdown-editor .wmde-markdown-color * {
    background-color: transparent !important;
  }

  /* Allow specific elements to have backgrounds */
  .markdown-editor .wmde-markdown code,
  .markdown-editor .wmde-markdown pre {
    @apply !bg-zinc-100 !text-newspaper-ink dark:!bg-zinc-800 dark:!text-zinc-100;
  }

  .markdown-editor .wmde-markdown pre code {
    @apply !text-newspaper-ink dark:!text-zinc-100;
  }

  .markdown-editor .wmde-markdown blockquote {
    @apply !border-l-4 !border-newspaper-accent !pl-4 dark:!border-red-400;
  }
}

@layer utilities {

  /* Enable smooth transitions for all interactive elements */
  * {
    transition-property: color, background-color, border-color, text-decoration-color, fill, stroke, transform, box-shadow, opacity;
    transition-timing-function: cubic-bezier(0.4, 0, 0.2, 1);
    transition-duration: 200ms;
  }

  /* Hardware acceleration for smoother transforms and prevent glitches */
  img,
  [class*="hover:-translate"],
  [class*="hover:scale"],
  [class*="group-hover:scale"],
  [class*="hover:shadow"] {
    -webkit-transform: translateZ(0);
    transform: translateZ(0);
    -webkit-backface-visibility: hidden;
    backface-visibility: hidden;
    -webkit-perspective: 1000px;
    perspective: 1000px;
  }
}