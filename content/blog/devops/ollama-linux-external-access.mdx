---
title: "如何讓 Ollama 在 Linux 上對外開放連線"
excerpt: "在 Linux 系統（包含 Proxmox LXC 容器）上設定 Ollama 服務，使其能夠接受外部機器的連接請求。完整的 systemd 配置教學與故障排除指南。"
coverImage: "/images/blog/ollama-linux.svg"
date: "2025-10-23"
author:
  name: "Doeshing"
  avatar: "/images/avatar.svg"
  bio: "Creative technologist crafting editorials in the browser. Exploring the sweet spot between storytelling, design, and modern web tooling."
tags: ["ollama", "linux", "networking", "systemd"]
published: true
featured: false
---

> [!info]
> **適用環境**：Linux 系統（包含 Proxmox LXC 容器）  
> **目標**：讓 Ollama 服務可以接受外部機器的連接請求

## 問題診斷

### 檢查 Ollama 執行狀態

```bash
# 檢查 Ollama 是否正在執行
ps aux | grep ollama

# 檢查 Ollama 偵聽的 ip 和 port
sudo ss -tlnp | grep 11434
```

> [!warning]
> 如果看到 `127.0.0.1:11434`，表示 Ollama 只偵聽本機連線，需要修改設定

![image](https://hackmd.io/_uploads/HJWkx6zhle.png)

## 解決方案

### Step 1：建立 systemd 服務覆蓋目錄

```bash
sudo mkdir -p /etc/systemd/system/ollama.service.d/
```

### Step 2：建立環境變數設定文件

```bash
sudo tee /etc/systemd/system/ollama.service.d/override.conf << EOF
[Service]
Environment="OLLAMA_HOST=0.0.0.0:11434"
EOF
```

### Step 3：重新載入並重啟服務

```bash
# 重新載入 systemd 設定
sudo systemctl daemon-reload

# 重啟 Ollama 服務
sudo systemctl restart ollama
```

### Step 4：驗證設定成功

```bash
# 檢查是否監聽所有介面
sudo ss -tlnp | grep 11434
```

> [!success]
> **成功標誌**：應該看到 `0.0.0.0:11434` 而不是 `127.0.0.1:11434`

![image](https://hackmd.io/_uploads/HyFTJ6zhex.png)

### Step 5：測試連接

```bash
# 測試本機連線
curl http://localhost:11434/api/tags
```
![image](https://hackmd.io/_uploads/HJpmbpG3le.png)

驗證成功後，你應該會看到類似以下的 JSON 回應，列出所有已安裝的模型。

## 故障排除

### 如果 systemd 方法無效

如果上述 systemd 配置方法無法正常運作，可以嘗試手動啟動 Ollama 服務：

```bash
# 停止 systemd 服務
sudo systemctl stop ollama

# 手動啟動並設定環境變數
sudo OLLAMA_HOST=0.0.0.0:11434 /usr/local/bin/ollama serve
```

### 防火牆檢查

確保防火牆允許 11434 port 的連線：

```bash
# 檢查防火牆狀態
sudo ufw status

# 如需要，開放 11434 port
sudo ufw allow 11434
```

> [!danger]
> **安全提醒**：對外開放 Ollama 服務時，請確保網路環境安全，避免未授權存取。建議僅在信任的內網環境中開放，或搭配 VPN、反向代理等安全措施使用。

## 總結

透過修改 systemd 服務設定，我們可以輕鬆讓 Ollama 服務從只接受本地連線改為接受所有網路介面的連線。完整的配置步驟包括：

1. 建立 systemd 服務覆蓋目錄
2. 設定 `OLLAMA_HOST` 環境變數為 `0.0.0.0:11434`
3. 重新載入 systemd 並重啟服務
4. 驗證服務正確監聽所有網路介面
5. 配置防火牆規則

記得在開放服務前做好適當的安全措施，包括防火牆設定、網路隔離，以及評估是否需要額外的身份驗證機制。
